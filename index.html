<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador Dinámico - Robot 1 GDL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Fira+Code:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'Fira Code', monospace; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        .math-card {
            background: #1e293b;
            color: #f8fafc;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .slider-custom::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }
        
        .nav-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }
    </style>
    <!-- Chosen Palette: Slate & Azure - Una combinación profesional de grises oscuros y azules vibrantes para un tono técnico y educativo. -->
    <!-- Application Structure Plan: 
         La aplicación se divide en tres niveles:
         1. Control Maestro: Panel lateral para manipular parámetros físicos y cinemáticos.
         2. Visualización y Resultados: Centro de la pantalla con el robot animado y la ecuación resultante dinámica que muestra los valores actuales integrados en la fórmula.
         3. Análisis Profundo: Gráficas comparativas y desglose teórico por pestañas.
         Se eligió esta estructura para que el usuario pueda ver el impacto matemático (fórmula) y el impacto físico (robot) simultáneamente.
    -->
    <!-- Visualization & Content Choices:
         - Robot: Canvas 2D interactivo. Meta: Visualizar posición.
         - Ecuación Dinámica: Texto reactivo con JS. Meta: Contexto matemático real.
         - Gráfica de Torque: Chart.js (Barras). Meta: Comparar magnitud de componentes.
         - Gráfica de Energía: Chart.js (Radar/Doughnut). Meta: Mostrar balance energético.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-900 leading-relaxed">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 py-4 px-6 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-blue-600 rounded-lg text-white font-bold text-xl">L</div>
                <h1 class="text-xl font-bold tracking-tight">Euler-Lagrange <span class="text-blue-600">Dynamics</span></h1>
            </div>
            <p class="text-xs text-slate-400 font-mono hidden sm:block">Modelado de Robot 1 GDL</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8">

        <!-- Simulation Interface -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Panel de Control -->
            <aside class="lg:col-span-4 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Parámetros Físicos</h2>
                    
                    <div class="space-y-6">
                        <!-- Masa -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-semibold text-slate-700">Masa (m₁)</label>
                                <span class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-mono" id="label-m">1.0 kg</span>
                            </div>
                            <input type="range" id="input-m" min="0.1" max="10" step="0.1" value="1.0" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-custom">
                        </div>

                        <!-- Longitud -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-semibold text-slate-700">Longitud (l₁)</label>
                                <span class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-mono" id="label-l">1.0 m</span>
                            </div>
                            <input type="range" id="input-l" min="0.1" max="5" step="0.1" value="1.0" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-custom">
                        </div>

                        <!-- Fricción -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-semibold text-slate-700">Coef. Fricción (b)</label>
                                <span class="bg-orange-50 text-orange-700 px-2 py-1 rounded text-xs font-mono" id="label-b">0.001</span>
                            </div>
                            <input type="range" id="input-b" min="0" max="1" step="0.001" value="0.001" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-custom">
                            <p class="text-[10px] text-slate-400 italic mt-1">Nota: Solo afecta al torque si hay velocidad activa.</p>
                        </div>
                    </div>

                    <div class="my-8 border-t border-slate-100"></div>
                    <h2 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Estado del Sistema</h2>

                    <div class="space-y-6">
                        <!-- Posición -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-semibold text-slate-700">Ángulo (θ)</label>
                                <span class="bg-slate-100 text-slate-700 px-2 py-1 rounded text-xs font-mono" id="label-th">45°</span>
                            </div>
                            <input type="range" id="input-th" min="-180" max="180" step="1" value="45" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-custom">
                        </div>

                        <!-- Velocidad -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-semibold text-slate-700">Velocidad (θ̇)</label>
                                <span class="bg-slate-100 text-slate-700 px-2 py-1 rounded text-xs font-mono" id="label-v">0.0 rad/s</span>
                            </div>
                            <input type="range" id="input-v" min="-10" max="10" step="0.1" value="0.0" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-custom">
                        </div>

                        <!-- Aceleración -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-semibold text-slate-700">Aceleración (θ̈)</label>
                                <span class="bg-slate-100 text-slate-700 px-2 py-1 rounded text-xs font-mono" id="label-a">0.0 rad/s²</span>
                            </div>
                            <input type="range" id="input-a" min="-10" max="10" step="0.1" value="0.0" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-custom">
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Visualización Central -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Robot Canvas -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center justify-center min-h-[400px]">
                    <canvas id="robotCanvas" width="500" height="400" class="w-full max-w-lg h-auto"></canvas>
                    <div class="mt-4 flex gap-6 text-xs font-mono text-slate-400">
                        <span id="coord-x">X: 0.00m</span>
                        <span id="coord-y">Y: 0.00m</span>
                    </div>
                </div>

                <!-- Ecuación Resultante Dinámica -->
                <div class="math-card overflow-x-auto">
                    <h3 class="text-blue-400 text-xs font-bold uppercase tracking-widest mb-3">Ecuación Dinámica en Tiempo Real</h3>
                    <div class="text-lg md:text-2xl font-mono py-2 text-center" id="dynamic-equation">
                        τ = (m₁l₁²)θ̈ + bθ̇ + m₁gl₁cos(θ)
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-xs text-slate-400 border-t border-slate-700 pt-4">
                        <div><span class="text-blue-400 font-bold">Inercia:</span> <span id="val-inertia">0.00</span> Nm</div>
                        <div><span class="text-orange-400 font-bold">Fricción:</span> <span id="val-friction">0.00</span> Nm</div>
                        <div><span class="text-purple-400 font-bold">Gravedad:</span> <span id="val-gravity">0.00</span> Nm</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-800 mb-4">Distribución del Torque</h3>
                <div class="chart-container">
                    <canvas id="torqueChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-800 mb-4">Balance Energético</h3>
                <div class="chart-container">
                    <canvas id="energyChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Theory Section -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 border-b border-slate-200 px-6 py-4">
                <h2 class="font-bold text-lg">Guía del Algoritmo Euler-Lagrange</h2>
            </div>
            <div class="p-6">
                <div class="flex gap-4 mb-6 border-b border-slate-100 overflow-x-auto pb-2">
                    <button onclick="switchTab('tab-k')" id="btn-tab-k" class="text-sm font-bold pb-2 nav-active">Cinemática</button>
                    <button onclick="switchTab('tab-e')" id="btn-tab-e" class="text-sm font-bold text-slate-400 pb-2">Energías</button>
                    <button onclick="switchTab('tab-l')" id="btn-tab-l" class="text-sm font-bold text-slate-400 pb-2">Lagrangiano</button>
                    <button onclick="switchTab('tab-f')" id="btn-tab-f" class="text-sm font-bold text-slate-400 pb-2">Resultado</button>
                </div>

                <div id="tab-k" class="tab-pane space-y-4">
                    <p class="text-slate-600 text-sm">Se determina la posición de la masa $m_1$ en el extremo del eslabón $l_1$ mediante trigonometría básica.</p>
                    <div class="bg-slate-50 p-4 rounded-lg font-mono text-sm border border-slate-200">
                        X = l₁ · cos(θ)<br>
                        Y = l₁ · sin(θ)
                    </div>
                </div>

                <div id="tab-e" class="tab-pane hidden space-y-4">
                    <p class="text-slate-600 text-sm">La energía cinética ($T$) depende de la velocidad al cuadrado, mientras que la potencial ($U$) depende de la altura ($Y$).</p>
                    <div class="bg-slate-50 p-4 rounded-lg font-mono text-sm border border-slate-200">
                        T = ½ · m₁ · l₁² · θ̇²<br>
                        U = m₁ · g · l₁ · sin(θ)
                    </div>
                </div>

                <div id="tab-l" class="tab-pane hidden space-y-4">
                    <p class="text-slate-600 text-sm">El Lagrangiano ($L = T - U$) y la función de disipación de Rayleigh ($D$) para la fricción viscosa.</p>
                    <div class="bg-slate-50 p-4 rounded-lg font-mono text-sm border border-slate-200">
                        L = ½m₁l₁²θ̇² - m₁gl₁sin(θ)<br>
                        D = ½bθ̇²
                    </div>
                </div>

                <div id="tab-f" class="tab-pane hidden space-y-4">
                    <p class="text-slate-600 text-sm">La ecuación diferencial que describe el comportamiento del sistema robótico.</p>
                    <div class="bg-slate-900 text-white p-4 rounded-lg font-mono text-sm shadow-inner">
                        m₁l₁²θ̈ + bθ̇ + m₁gl₁cos(θ) = τ
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="mt-12 py-8 bg-white border-t border-slate-200 text-center">
        <p class="text-slate-400 text-xs font-mono uppercase tracking-widest">Modelado Dinámico de Sistemas Robóticos</p>
        <p class="text-slate-600 text-sm mt-2">Elaborado con gemini por Angel Anaya</p>
    </footer>

    <script>
        // Constantes
        const g = 9.81;

        // Estado
        const state = {
            m: 1.0,
            l: 1.0,
            b: 0.001,
            thDeg: 45,
            v: 0.0,
            a: 0.0
        };

        // Charts
        let torqueChart, energyChart;

        // Referencias DOM
        const inputs = {
            m: document.getElementById('input-m'),
            l: document.getElementById('input-l'),
            b: document.getElementById('input-b'),
            th: document.getElementById('input-th'),
            v: document.getElementById('input-v'),
            a: document.getElementById('input-a')
        };

        const labels = {
            m: document.getElementById('label-m'),
            l: document.getElementById('label-l'),
            b: document.getElementById('label-b'),
            th: document.getElementById('label-th'),
            v: document.getElementById('label-v'),
            a: document.getElementById('label-a'),
            cx: document.getElementById('coord-x'),
            cy: document.getElementById('coord-y'),
            eq: document.getElementById('dynamic-equation'),
            inertia: document.getElementById('val-inertia'),
            friction: document.getElementById('val-friction'),
            gravity: document.getElementById('val-gravity')
        };

        const canvas = document.getElementById('robotCanvas');
        const ctx = canvas.getContext('2d');

        function init() {
            // Eventos
            Object.keys(inputs).forEach(key => {
                inputs[key].addEventListener('input', (e) => {
                    const val = parseFloat(e.target.value);
                    if (key === 'th') state.thDeg = val;
                    else state[key] = val;
                    update();
                });
            });

            initCharts();
            update();
        }

        function update() {
            // Actualizar Labels
            labels.m.textContent = `${state.m.toFixed(1)} kg`;
            labels.l.textContent = `${state.l.toFixed(1)} m`;
            labels.b.textContent = state.b.toFixed(3);
            labels.th.textContent = `${state.thDeg}°`;
            labels.v.textContent = `${state.v.toFixed(1)} rad/s`;
            labels.a.textContent = `${state.a.toFixed(1)} rad/s²`;

            // Cálculos
            const thRad = state.thDeg * (Math.PI / 180);
            const x = state.l * Math.cos(thRad);
            const y = state.l * Math.sin(thRad);

            labels.cx.textContent = `X: ${x.toFixed(2)}m`;
            labels.cy.textContent = `Y: ${y.toFixed(2)}m`;

            const tInertia = (state.m * state.l * state.l) * state.a;
            const tFriction = state.b * state.v;
            const tGravity = state.m * g * state.l * Math.cos(thRad);
            const tTotal = tInertia + tFriction + tGravity;

            labels.inertia.textContent = tInertia.toFixed(3);
            labels.friction.textContent = tFriction.toFixed(3);
            labels.gravity.textContent = tGravity.toFixed(3);

            // Ecuación Dinámica Dinámica
            // Estructura: (M)a + (b)v + (G) = T
            labels.eq.innerHTML = `
                <span class="text-blue-400">(${ (state.m * state.l * state.l).toFixed(2) })</span>(${state.a.toFixed(1)}) + 
                <span class="text-orange-400">(${state.b.toFixed(3)})</span>(${state.v.toFixed(1)}) + 
                <span class="text-purple-400">(${ (state.m * g * state.l * Math.cos(thRad)).toFixed(2) })</span> = 
                <span class="text-white font-bold">${tTotal.toFixed(2)} Nm</span>
            `;

            draw(thRad, x, y);
            updateCharts(tInertia, tFriction, tGravity, thRad);
        }

        function draw(th, x, y) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const originX = canvas.width / 2;
            const originY = canvas.height / 2;
            const scale = 60; // píxeles por metro

            // Ejes de referencia
            ctx.beginPath();
            ctx.strokeStyle = '#f1f5f9';
            ctx.moveTo(0, originY); ctx.lineTo(canvas.width, originY);
            ctx.moveTo(originX, 0); ctx.lineTo(originX, canvas.height);
            ctx.stroke();

            // Brazo
            const targetX = originX + (x * scale);
            const targetY = originY - (y * scale); // Invertir Y para vista estándar

            ctx.beginPath();
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 10;
            ctx.lineCap = 'round';
            ctx.moveTo(originX, originY);
            ctx.lineTo(targetX, targetY);
            ctx.stroke();

            // Pivote
            ctx.beginPath();
            ctx.fillStyle = '#1e293b';
            ctx.arc(originX, originY, 12, 0, Math.PI * 2);
            ctx.fill();

            // Masa
            ctx.beginPath();
            ctx.fillStyle = '#1e293b';
            ctx.arc(targetX, targetY, 8 + (state.m * 2), 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#white';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Vector Gravedad
            ctx.beginPath();
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#a855f7';
            ctx.moveTo(targetX, targetY);
            ctx.lineTo(targetX, targetY + 50);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function initCharts() {
            const ctxT = document.getElementById('torqueChart').getContext('2d');
            torqueChart = new Chart(ctxT, {
                type: 'bar',
                data: {
                    labels: ['Inercia', 'Fricción', 'Gravedad'],
                    datasets: [{
                        label: 'Magnitud (Nm)',
                        data: [0, 0, 0],
                        backgroundColor: ['#3b82f6', '#f97316', '#a855f7'],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } },
                    plugins: { legend: { display: false } }
                }
            });

            const ctxE = document.getElementById('energyChart').getContext('2d');
            energyChart = new Chart(ctxE, {
                type: 'doughnut',
                data: {
                    labels: ['Cinética (T)', 'Potencial (U)'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#10b981', '#a855f7'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%'
                }
            });
        }

        function updateCharts(ti, tf, tg, th) {
            torqueChart.data.datasets[0].data = [Math.abs(ti), Math.abs(tf), Math.abs(tg)];
            torqueChart.update('none');

            const kinetic = 0.5 * state.m * state.l * state.l * state.v * state.v;
            const potential = state.m * g * state.l * Math.sin(th);
            
            energyChart.data.datasets[0].data = [Math.max(0.1, kinetic), Math.max(0.1, Math.abs(potential))];
            energyChart.update('none');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            
            document.querySelectorAll('button[id^="btn-tab"]').forEach(b => {
                b.classList.remove('nav-active');
                b.classList.add('text-slate-400');
            });
            document.getElementById('btn-' + id).classList.add('nav-active');
            document.getElementById('btn-' + id).classList.remove('text-slate-400');
        }

        window.onload = init;
    </script>
</body>
</html>
